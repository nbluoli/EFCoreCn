---
title: Generated Values | Microsoft Docs
author: rowanmiller
ms.author: divega
ms.date: 10/27/2016
ms.assetid: eb082011-11a1-41b4-a108-15daafa03e80
ms.technology: entity-framework-core
uid: core/modeling/generated-properties
---

# Generated Values

## Value Generation Patterns

有三种可用于属性的值生成模式。

There are three value generation patterns that can be used for properties.

### No value generation

没有值生成意味着您将始终提供将要保存到数据库中的有效值。在添加到上下文之前，必须将有效值赋给新实体。

No value generation means that you will always supply a valid value to be saved to the database. This valid value must be assigned to new entities before they are added to the context.

### Value generated on add

添加时生成值意味着为新实体生成值。

Value generated on add means that a value is generated for new entities.

根据正在使用的数据库提供程序，可以通过EF或数据库在客户端生成值。如果该值由数据库生成，则EF可以在将实体添加到上下文时指定临时值。这个临时值将在`SaveChanges()`时由数据库生成的值取代。

Depending on the database provider being used, values may be generated client side by EF or in the database. If the value is generated by the database, then EF may assign a temporary value when you add the entity to the context. This temporary value will then be replaced by the database generated value during `SaveChanges()`.

如果你添加属性有值的实体给上下文，则EF将尝试插入该值，而不是生成一个新值。一个属性被认为已赋值，它不会再被分配一个CLR默认值（`string`默认`null`, `int`默认`0`, `Guid`默认`Guid.Empty`等等）。了解更多信息参见[Explicit values for generated properties](..\saving\explicit-values-generated-properties.html)。

If you add an entity to the context that has a value assigned to the property, then EF will attempt to insert that value rather than generating a new one. A property is considered to have a value assigned if it is not assigned the CLR default value (`null` for `string`, `0` for `int`, `Guid.Empty` for `Guid`, etc.). For more information, see [Explicit values for generated properties](..\saving\explicit-values-generated-properties.html).

> [!WARNING]
> 如何为添加的实体生成值将取决于正在使用的数据库提供程序。有些数据库提供程序可能会自动为某些属性类型设置生成值。但有些数据库提供程序要求你手动配置如果生成值。

> How the value is generated for added entities will depend on the database provider being used. Database providers may automatically setup value generation for some property types, but others may require you to manually setup how the value is generated.

> 例如，当使用SQL Server时，将自动为`GUID`属性生成一个值（使用SQL Server顺序GUID算法）。然而，如果你在添加时指定一个`DateTime `属性生成值，那么你必须设置要生成值的方法。这样做的一种方法，是配置`GETDATE()`默认值，参见[Default Values](relational/default-values.html)。

> For example, when using SQL Server, values will be automatically generated for `GUID` properties (using the SQL Server sequential GUID algorithm). However, if you specify that a `DateTime` property is generated on add, then you must setup a way for the values to be generated. One way to do this, is to configure a default value of `GETDATE()`, see [Default Values](relational/default-values.html).

### Value generated on add or update

在添加或更新时生成值意味着在每次保存记录时都有一个新值生成。

Value generated on add or update means that a new value is generated every time the record is saved (insert or update).

像`value generated on add`一节说的那样，如果为实体的新添加的实例指定属性值，则将插入该值，而不是生成的值。也可以在更新时设置一个显式值。有关更多信息，请参见[Explicit values for generated properties](..\saving\explicit-values-generated-properties.html)。

Like `value generated on add`, if you specify a value for the property on a newly added instance of an entity, that value will be inserted rather than a value being generated. It is also possible to set an explicit value when updating. For more information, see [Explicit values for generated properties](..\saving\explicit-values-generated-properties.html).

> [!WARNING]
> 如何为添加和更新的实体生成值将取决于正在使用的数据库提供程序。数据库提供程序可能会自动为某些属性类型设置值生成，而其他的则要求您手动设置如何生成值。

> How the value is generated for added and updated entities will depend on the database provider being used. Database providers may automatically setup value generation for some property types, while others will require you to manually setup how the value is generated.

> 例如，使用SQL Server时，`byte[]`属性被设置为在添加或更新时生成值并且标记为并发令牌，将会被设置`rowversion`数据类型——值将在数据库中生成。然而，如果你指定一个`DateTime`属性在添加或更新时生成值，那么你必须设置生成值的方法。一种做法，是配置一个默认值`GETDATE()`（参见[Default Values](relational/default-values.html))去生成新的行值。您可以使用数据库触发器在更新过程中生成值（例如下面的示例触发器）。
>    
> For example, when using SQL Server, `byte[]` properties that are set as generated on add or update and marked as concurrency tokens, will be setup with the `rowversion` data type - so that values will be generated in the database. However, if you specify that a `DateTime` property is generated on add or update, then you must setup a way for the values to be generated. One way to do this, is to configure a default value of `GETDATE()` (see [Default Values](relational/default-values.html)) to generate values for new rows. You could then use a database trigger to generate values during updates (such as the following example trigger).

> <!--[!code-sql[Main](../../../samples/core/Modeling/FluentAPI/Samples/ValueGeneratedOnAddOrUpdate.sql)]-->

```sql
CREATE TRIGGER [dbo].[Blogs_UPDATE] ON [dbo].[Blogs]
	AFTER UPDATE
AS
BEGIN
	SET NOCOUNT ON;
                  
	IF ((SELECT TRIGGER_NESTLEVEL()) > 1) RETURN;
	
	DECLARE @Id INT
		
	SELECT @Id = INSERTED.BlogId
	FROM INSERTED
          
	UPDATE dbo.Blogs
	SET LastUpdated = GETDATE()
	WHERE BlogId = @Id
END
```

## Conventions

按照约定，在添加时主键将被设置为一个整型或GUID数据类型的生成值。其它所有的属性将被设置无值生成。

By convention, primary keys that are of an integer or GUID data type will be setup to have values generated on add. All other properties will be setup with no value generation.

## Data Annotations

### No value generation (Data Annotations)

<!--[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/Samples/ValueGeneratedNever.cs#Sample)]-->
```csharp
public class Blog
{
    [DatabaseGenerated(DatabaseGeneratedOption.None)]
    public int BlogId { get; set; }
    public string Url { get; set; }
}
```
### Value generated on add (Data Annotations)

<!--[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/Samples/ValueGeneratedOnAdd.cs#Sample)]-->
```csharp
public class Blog
{
    public int BlogId { get; set; }
    public string Url { get; set; }
    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
    public DateTime Inserted { get; set; }
}
```

> [!WARNING]
> 这只是让EF知道值是为添加的实体生成的，它不能保证EF将设置真实机制来生成值。参见本文[Value generated on add](#value-generated-on-add)一节了解更多详情。

> This just lets EF know that values are generated for added entities, it does not guarantee that EF will setup the actual mechanism to generate values. See [Value generated on add](#value-generated-on-add) section for more details.

### Value generated on add or update (Data Annotations)

<!--[!code-csharp[Main](../../../samples/core/Modeling/DataAnnotations/Samples/ValueGeneratedOnAddOrUpdate.cs#Sample)]-->
```csharp
public class Blog
{
    public int BlogId { get; set; }
    public string Url { get; set; }
    [DatabaseGenerated(DatabaseGeneratedOption.Identity)]
    public DateTime Inserted { get; set; }
}
```


> [!WARNING]
> 这只是让EF知道值是为添加或修改的实体而生成的，它不能保证EF将设置真实机制来生成值。参见本文[Value generated on add or update](#value-generated-on-add-or-update)一节了解更多详情。

> This just lets EF know that values are generated for added or updated entities, it does not guarantee that EF will setup the actual mechanism to generate values. See [Value generated on add or update](#value-generated-on-add-or-update) section for more details.

## Fluent API

你可以使用Fluent API去更改给定属性值生成模式。

You can use the Fluent API to change the value generation pattern for a given property.

### No value generation (Fluent API)

<!--[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/Samples/ValueGeneratedNever.cs#Sample)]-->
```csharp
modelBuilder.Entity<Blog>()
    .Property(b => b.BlogId)
    .ValueGeneratedNever();
```

### Value generated on add (Fluent API)

<!--[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/Samples/ValueGeneratedOnAdd.cs#Sample)]-->
```csharp
modelBuilder.Entity<Blog>()
    .Property(b => b.Inserted)
    .ValueGeneratedOnAdd();
```

> [!WARNING]
> `ValueGeneratedOnAdd()`只是让EF知道值是为添加的实体生成的。它不保证EF将设置真实机制去生成值。参见本文[Value generated on add](#value-generated-on-add)一节了解更多详情。

> `ValueGeneratedOnAdd()` just lets EF know that values are generated for added entities, it does not guarantee that EF will setup the actual mechanism to generate values.  See [Value generated on add](#value-generated-on-add) section for more details.

### Value generated on add or update (Fluent API)

<!--[!code-csharp[Main](../../../samples/core/Modeling/FluentAPI/Samples/ValueGeneratedOnAddOrUpdate.cs#Sample)]-->
```csharp
modelBuilder.Entity<Blog>()
    .Property(b => b.LastUpdated)
    .ValueGeneratedOnAddOrUpdate();
```

> [!WARNING]
> 这只是让EF知道值是为添加或修改的实体生成的。它不保证EF将设置真实机制去生成值。参见本文[Value generated on add or update](#value-generated-on-add-or-update)一节了解更多详情。

> This just lets EF know that values are generated for added or updated entities, it does not guarantee that EF will setup the actual mechanism to generate values. See [Value generated on add or update](#value-generated-on-add-or-update) section for more details.
